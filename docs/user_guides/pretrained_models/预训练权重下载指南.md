# é¢„è®­ç»ƒæƒé‡ä¸‹è½½æŒ‡å—

## é—®é¢˜è¯´æ˜

ç”±äºç½‘ç»œé™åˆ¶ï¼Œç›´æ¥ä» HuggingFace ä¸‹è½½é¢„è®­ç»ƒæƒé‡å¯èƒ½å¤±è´¥ã€‚æœ¬æŒ‡å—æä¾›å¤šç§è§£å†³æ–¹æ¡ˆã€‚

---

## âœ… å·²å®ç°ï¼šè‡ªåŠ¨ä½¿ç”¨å›½å†…é•œåƒ

ä»£ç å·²æ›´æ–°ï¼Œ**é»˜è®¤ä½¿ç”¨ HuggingFace å›½å†…é•œåƒç«™**ï¼ˆhf-mirror.comï¼‰ä¸‹è½½æƒé‡ã€‚

### ä½¿ç”¨æ–¹æ³•

ç›´æ¥è¿è¡Œè„šæœ¬å³å¯ï¼Œä»£ç ä¼šè‡ªåŠ¨ï¼š
1. è®¾ç½®ç¯å¢ƒå˜é‡ `HF_ENDPOINT=https://hf-mirror.com`
2. ä»é•œåƒç«™ä¸‹è½½é¢„è®­ç»ƒæƒé‡
3. å¦‚æœä¸‹è½½å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°æ— é¢„è®­ç»ƒæ¨¡å¼

```bash
cd src
bash run_fedlora_pretrained.sh
```

### ä¸‹è½½ä¿¡æ¯

- **æƒé‡æ–‡ä»¶**: `vit_tiny_patch16_224.augreg_in21k_ft_in1k`
- **æ–‡ä»¶å¤§å°**: ~22 MB
- **ä¿å­˜ä½ç½®**: `~/.cache/huggingface/hub/`
- **ä¸‹è½½è¿›åº¦**: timm åº“ä¼šæ˜¾ç¤ºä¸‹è½½è¿›åº¦

---

## ğŸ“¥ æƒé‡ç¼“å­˜ä½ç½®

### é»˜è®¤ç¼“å­˜ç›®å½•

```bash
~/.cache/huggingface/hub/
```

å®Œæ•´è·¯å¾„ï¼ˆä½ çš„ç³»ç»Ÿï¼‰ï¼š
```
/home/moqianyu_26/.cache/huggingface/hub/
```

### æŸ¥çœ‹å·²ç¼“å­˜çš„æƒé‡

```bash
ls -lh ~/.cache/huggingface/hub/
```

---

## ğŸ”§ å…¶ä»–ä¸‹è½½æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šæ‰‹åŠ¨ä½¿ç”¨é•œåƒä¸‹è½½

å¦‚æœè‡ªåŠ¨ä¸‹è½½ä»ç„¶å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ï¼š

```bash
# åˆ›å»ºç¼“å­˜ç›®å½•
mkdir -p ~/.cache/huggingface/hub/models--timm--vit_tiny_patch16_224.augreg_in21k_ft_in1k/snapshots/

# ä½¿ç”¨ wget ä»é•œåƒä¸‹è½½
wget https://hf-mirror.com/timm/vit_tiny_patch16_224.augreg_in21k_ft_in1k/resolve/main/model.safetensors \
  -O ~/.cache/huggingface/hub/vit_tiny_patch16_224.safetensors
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ä»£ç†

å¦‚æœæœ‰ä»£ç†æœåŠ¡å™¨ï¼š

```bash
export http_proxy=http://your-proxy:port
export https_proxy=http://your-proxy:port

# ç„¶åè¿è¡Œè„šæœ¬
bash run_fedlora_pretrained.sh
```

### æ–¹æ¡ˆ 3ï¼šä»å…¶ä»–æœºå™¨ä¼ è¾“

å¦‚æœæœ‰å…¶ä»–å¯ä»¥è®¿é—®å¤–ç½‘çš„æœºå™¨ï¼š

**æ­¥éª¤ 1ï¼šåœ¨å¤–ç½‘æœºå™¨ä¸Šä¸‹è½½**
```bash
# åœ¨å¤–ç½‘æœºå™¨ä¸Šè¿è¡Œ
python3 -c "import timm; timm.create_model('vit_tiny_patch16_224', pretrained=True)"
```

**æ­¥éª¤ 2ï¼šæ‰¾åˆ°æƒé‡æ–‡ä»¶**
```bash
# æŸ¥æ‰¾ä¸‹è½½çš„æƒé‡
find ~/.cache/huggingface -name "*.safetensors" -o -name "*.bin"
```

**æ­¥éª¤ 3ï¼šä¼ è¾“åˆ°å½“å‰æœºå™¨**
```bash
# ä½¿ç”¨ scp ä¼ è¾“
scp user@remote:~/.cache/huggingface/hub/models--timm--vit_tiny_patch16_224*/snapshots/*/model.safetensors \
  ~/.cache/huggingface/hub/
```

### æ–¹æ¡ˆ 4ï¼šä½¿ç”¨æœ¬åœ°æƒé‡æ–‡ä»¶

å¦‚æœä½ å·²ç»æœ‰æƒé‡æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šè·¯å¾„ï¼š

```bash
python3 federated_main.py \
    --model_variant pretrained \
    --pretrained_path /path/to/vit_tiny_patch16_224.safetensors \
    --alg fedlora \
    --model vit \
    --dataset cifar \
    --image_size 224 \
    --lr 0.0001 \
    --gpu 0
```

---

## ğŸ” ä¸‹è½½è¿›åº¦ç›‘æ§

### timm ä¸‹è½½æ—¶çš„è¾“å‡º

æ­£å¸¸ä¸‹è½½æ—¶ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
============================================================
[Pretrained ViT] æ­£åœ¨åŠ è½½é¢„è®­ç»ƒæ¨¡å‹...
============================================================
  ä½¿ç”¨ HuggingFace é•œåƒ: https://hf-mirror.com
  ä» timm ä¸‹è½½é¢„è®­ç»ƒæƒé‡ï¼ˆImageNet-1kï¼‰
  æƒé‡å¤§å°: ~22 MBï¼Œé¦–æ¬¡ä¸‹è½½éœ€è¦ä¸€äº›æ—¶é—´...
Downloading: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22.1M/22.1M [00:05<00:00, 4.2MB/s]
  âœ“ é¢„è®­ç»ƒæƒé‡ä¸‹è½½æˆåŠŸ
  æ¨¡å‹: vit_tiny_patch16_224
  æ€»å‚æ•°é‡: 5,717,130
  åˆ†ç±»æ•°: 10
  è¾“å…¥å°ºå¯¸: 224x224
============================================================
```

### ä¸‹è½½å¤±è´¥æ—¶çš„è¾“å‡º

å¦‚æœä¸‹è½½å¤±è´¥ï¼Œä¼šè‡ªåŠ¨é™çº§ï¼š

```
  âœ— ä¸‹è½½å¤±è´¥: [Errno 101] Network is unreachable
  â†’ é™çº§åˆ°æ— é¢„è®­ç»ƒæ¨¡å¼ï¼ˆä»é›¶åˆå§‹åŒ–ï¼‰
  â†’ æ³¨æ„ï¼šæ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™ï¼ˆé¢„æœŸå‡†ç¡®ç‡ 15-25% vs 70-85%ï¼‰
  âœ“ å·²åˆ›å»ºæ— é¢„è®­ç»ƒæƒé‡çš„ ViT æ¨¡å‹
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢ï¼Ÿ

**A**: å›½å†…é•œåƒç«™é€Ÿåº¦åº”è¯¥è¾ƒå¿«ï¼ˆé€šå¸¸ 1-5 MB/sï¼‰ã€‚å¦‚æœä»ç„¶å¾ˆæ…¢ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- å°è¯•æ›´æ¢æ—¶é—´æ®µä¸‹è½½
- è€ƒè™‘ä½¿ç”¨æ–¹æ¡ˆ 3ï¼ˆä»å…¶ä»–æœºå™¨ä¼ è¾“ï¼‰

### Q2: æç¤º "Network is unreachable"ï¼Ÿ

**A**: å¯èƒ½çš„åŸå› ï¼š
1. é•œåƒç«™æš‚æ—¶ä¸å¯ç”¨ â†’ ç¨åé‡è¯•
2. ç½‘ç»œé…ç½®é—®é¢˜ â†’ æ£€æŸ¥é˜²ç«å¢™/ä»£ç†è®¾ç½®
3. DNS è§£æé—®é¢˜ â†’ å°è¯• `ping hf-mirror.com`

### Q3: ä¸‹è½½ä¸­æ–­æ€ä¹ˆåŠï¼Ÿ

**A**: timm ä¼šè‡ªåŠ¨æ–­ç‚¹ç»­ä¼ ã€‚å¦‚æœå¤šæ¬¡ä¸­æ–­ï¼š
```bash
# æ¸…é™¤ç¼“å­˜é‡æ–°ä¸‹è½½
rm -rf ~/.cache/huggingface/hub/models--timm--vit_tiny_patch16_224*
bash run_fedlora_pretrained.sh
```

### Q4: å¦‚ä½•éªŒè¯æƒé‡å·²ä¸‹è½½ï¼Ÿ

**A**: æ£€æŸ¥ç¼“å­˜ç›®å½•ï¼š
```bash
# æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶
ls -lh ~/.cache/huggingface/hub/

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼æ–‡ä»¶ï¼š
# models--timm--vit_tiny_patch16_224.augreg_in21k_ft_in1k/
```

### Q5: ä¸æƒ³ä½¿ç”¨é•œåƒï¼Œç›´æ¥ç”¨å®˜æ–¹æºï¼Ÿ

**A**: ä¿®æ”¹ `models.py` ä¸­çš„ `get_pretrained_vit` å‡½æ•°è°ƒç”¨ï¼š
```python
# åœ¨ federated_main.py ä¸­
global_model = get_pretrained_vit(
    num_classes=args.num_classes,
    image_size=args.image_size,
    use_mirror=False  # è®¾ç½®ä¸º False
)
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | åˆå§‹å‡†ç¡®ç‡ | æœ€ç»ˆå‡†ç¡®ç‡ | ä¸‹è½½éœ€æ±‚ |
|------|-----------|-----------|---------|
| é¢„è®­ç»ƒï¼ˆæ¨èï¼‰ | 40-60% | **70-85%** | éœ€è¦ä¸‹è½½ 22MB |
| æ— é¢„è®­ç»ƒ | ~10% | 15-25% | æ— éœ€ä¸‹è½½ |

**å¼ºçƒˆå»ºè®®**ï¼šå°½é‡ä½¿ç”¨é¢„è®­ç»ƒæƒé‡ï¼Œæ€§èƒ½æå‡ **3-5 å€**ï¼

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•é•œåƒè¿æ¥

```bash
# æµ‹è¯•é•œåƒç«™æ˜¯å¦å¯è®¿é—®
curl -I https://hf-mirror.com

# åº”è¯¥è¿”å› HTTP/2 200
```

### æµ‹è¯•ä¸‹è½½åŠŸèƒ½

```bash
# åˆ›å»ºæµ‹è¯•è„šæœ¬
python3 << 'EOF'
import os
os.environ['HF_ENDPOINT'] = 'https://hf-mirror.com'

import timm
print("å¼€å§‹æµ‹è¯•ä¸‹è½½...")
model = timm.create_model('vit_tiny_patch16_224', pretrained=True, num_classes=10)
print("âœ“ ä¸‹è½½æˆåŠŸï¼")
print(f"æ¨¡å‹å‚æ•°é‡: {sum(p.numel() for p in model.parameters()):,}")
EOF
```

---

## ğŸ“ ç¯å¢ƒå˜é‡è¯´æ˜

### HF_ENDPOINT

æ§åˆ¶ HuggingFace Hub çš„è®¿é—®åœ°å€ï¼š

```bash
# ä½¿ç”¨å®˜æ–¹æºï¼ˆé»˜è®¤ï¼‰
unset HF_ENDPOINT

# ä½¿ç”¨å›½å†…é•œåƒ
export HF_ENDPOINT=https://hf-mirror.com

# æ°¸ä¹…è®¾ç½®ï¼ˆæ·»åŠ åˆ° ~/.bashrcï¼‰
echo 'export HF_ENDPOINT=https://hf-mirror.com' >> ~/.bashrc
source ~/.bashrc
```

### HF_HOME

æ§åˆ¶ç¼“å­˜ç›®å½•ä½ç½®ï¼š

```bash
# æ›´æ”¹ç¼“å­˜ç›®å½•ï¼ˆå¦‚æœé»˜è®¤ç›®å½•ç©ºé—´ä¸è¶³ï¼‰
export HF_HOME=/path/to/large/disk/.cache/huggingface
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **HuggingFace é•œåƒç«™**: https://hf-mirror.com
- **timm æ–‡æ¡£**: https://timm.fast.ai/
- **æ¨¡å‹å¡ç‰‡**: https://huggingface.co/timm/vit_tiny_patch16_224.augreg_in21k_ft_in1k

---

**æ›´æ–°æ—¶é—´**: 2026-01-06  
**çŠ¶æ€**: âœ… å·²æ·»åŠ å›½å†…é•œåƒæ”¯æŒ
